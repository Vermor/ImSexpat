<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Article | ImSexpat</title>
    <meta name="description" content="" />
    <meta property="og:title" content="" />
    <meta property="og:description" content="" />
    <meta property="og:image" content="" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="brand">ImSexpat</div>
      <a class="admin-link" href="/articles">Tous les articles</a>
    </header>

    <main>
      <article class="admin-panel admin-panel-wide article-view">
        <h1 id="title">Chargement...</h1>
        <p id="excerpt" class="subtitle"></p>
        <img id="cover" class="cover-image" alt="" hidden />
        <div id="content" class="article-content"></div>
      </article>
    </main>

    <script>
      const pathParts = window.location.pathname.split('/').filter(Boolean);
      const slug = pathParts[pathParts.length - 1] || '';

      const titleEl = document.getElementById('title');
      const excerptEl = document.getElementById('excerpt');
      const contentEl = document.getElementById('content');
      const coverEl = document.getElementById('cover');
      const setMeta = (selector, value) => {
        const el = document.querySelector(selector);
        if (el) {
          el.setAttribute('content', value || '');
        }
      };

      fetch(`/api/articles/${encodeURIComponent(slug)}`, { cache: 'no-store' })
        .then((res) => {
          if (!res.ok) throw new Error('Article introuvable');
          return res.json();
        })
        .then((article) => {
          titleEl.textContent = article.title;
          excerptEl.textContent = article.excerpt || '';
          document.title = article.seoTitle || article.title || 'Article | ImSexpat';
          setMeta('meta[name=\"description\"]', article.seoDescription || article.excerpt || '');
          setMeta('meta[property=\"og:title\"]', article.seoTitle || article.title || '');
          setMeta('meta[property=\"og:description\"]', article.seoDescription || article.excerpt || '');
          setMeta('meta[property=\"og:image\"]', article.ogImageUrl || article.coverImageUrl || '');

          if (article.coverImageUrl) {
            coverEl.src = article.coverImageUrl;
            coverEl.alt = article.title;
            coverEl.hidden = false;
          }

          contentEl.innerHTML = article.content || '<p>Contenu vide.</p>';
        })
        .catch(() => {
          titleEl.textContent = 'Article introuvable';
          excerptEl.textContent = '';
          contentEl.innerHTML = '<p>Ce contenu nest pas disponible.</p>';
        });
    </script>
  </body>
</html>
